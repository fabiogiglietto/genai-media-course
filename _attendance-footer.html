<style>
  .attendance-code {
    font-weight: bold;
    font-family: monospace;
  }
  @media print {
    .attendance-code { display: none !important; }
  }
</style>
<script>
  (function() {
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/16esB9eA2yhu4AVwvLbjZJq-DClcWVg23aUtwEyax0fA/gviz/tq?tqx=out:csv&range=A1';
    const POLL_INTERVAL = 15000;
    const FOOTER_BASE = 'IA Generativa e Media \u00b7 A.A. 2025/2026';

    var codeSpan = document.createElement('span');
    codeSpan.className = 'attendance-code';

    function getFooterEl() {
      return document.querySelector('.footer.footer-default p');
    }

    var timerId = null;

    function poll() {
      fetch(SHEET_URL + '&_=' + Date.now())
        .then(function(r) { return r.text(); })
        .then(function(csv) {
          var code = csv.trim().replace(/^"|"$/g, '').trim();
          var footerP = getFooterEl();
          if (!footerP) return;
          if (code) {
            codeSpan.textContent = code;
            footerP.textContent = FOOTER_BASE + ' \u00b7 ';
            footerP.appendChild(codeSpan);
          } else {
            footerP.textContent = FOOTER_BASE;
          }
        })
        .catch(function() {
          // silently ignore â€” keep last known state
        });
    }

    function startPolling() {
      if (!timerId) {
        poll();
        timerId = setInterval(poll, POLL_INTERVAL);
      }
    }

    function stopPolling() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
    }

    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        stopPolling();
      } else {
        startPolling();
      }
    });

    startPolling();
  })();
</script>
